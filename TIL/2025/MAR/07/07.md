<aside>
ğŸ’¡

# ë¹ ë¥¸ ê²°ë¡ !

- @Transactional ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ë©´ CGLIBê°€ íƒ€ê²Ÿ í´ë˜ìŠ¤ì˜ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë§Œë“¤ê³  ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ê¸° ì „ `TransactionInterceptor`
  ì—ì„œ `TransactionManager`ë¥¼ í†µí•´ íŠ¸ëœì­ì…˜ ì„¤ì •(AutoCommit false ë“±)ê³¼ ì»¤ë„¥ì…˜ ìƒì„±ë“±ì˜ ì‘ì—…ì„ ì‹¤í–‰í•´ì¤€ë‹¤. ìƒì„±ëœ
  ì»¤ë„¥ì…˜ì€ `TransactionSynchronizationManager` ì— ì˜í•´ì„œ ë©€í‹° ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œë„ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬ëœë‹¤.
    - CGLIBê°€ íƒ€ê²Ÿ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì€ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë§Œë“¤ê³  ë©”ì„œë“œë¥¼ ì‹¤í–‰ì‹œì¼œì¤€ë‹¤.
        - ê·¸ë ‡ê¸° ë•Œë¬¸ì— private ë©”ì„œë“œì—ëŠ” @Transactional ì‚¬ìš©ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤.
        - ë˜í•œ, ê°™ì€ í´ë˜ìŠ¤ ë‚´ë¶€ì—ì„œ ë‹¤ë¥¸ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ë•Œ @Transactional ì‚¬ìš©ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤.
            - https://lob-dev.tistory.com/73
- ì´í›„ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•˜ëŠ” ë¡œì§ì„ ìˆ˜í–‰í•  ë•Œ ë§Œë“¤ì–´ì§„ ì»¤ë„¥ì…˜ì„ íšë“í•´ì„œ ì‚¬ìš©í•œë‹¤.
- ë©”ì„œë“œì˜ ì‹¤í–‰ì´ ì›ìì„±ì„ ë³´ì¥í•˜ë„ë¡ ì „ì²´ ì»¤ë°‹ or ë¡¤ë°± í•´ì¤€ë‹¤.

</aside>

# @Transactionalì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´?

- ìŠ¤í”„ë§ì€ ê°ì²´ë¥¼ ê·¸ëŒ€ë¡œ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ì—¬ ì‚¬ìš©í•œë‹¤.

# @Transactionalì„ ì‚¬ìš©í•œë‹¤ë©´??

- ìŠ¤í”„ë§ì€ ê°ì²´ì˜ í”„ë¡ì‹œë¥¼ ìƒì„±í•´ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ì—¬ ì‚¬ìš©í•œë‹¤.

# ë‚´ë¶€ì ìœ¼ë¡œ ì–´ë–»ê²Œ  êµ¬ë™ë˜ë‚˜?

## 1. `TransactionInterceptor`

![image.png](./image/1.png)

- @Transactional ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ ë©”ì„œë“œê°€ ì‹¤í–‰ë˜ë©´ íŠ¸ëœì­ì…˜ ì¸í„°ì…‰í„°ì˜ invoke() ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì–´ íŠ¸ëœì­ì…˜ ì¤€ë¹„ë¥¼ ì‹œì‘í•œë‹¤.

![image.png](./image/2.png)

## 2. `TransactionAspectSupport`

![image.png](./image/3.png)

<details>
<summary>invokeWithinTransaction()</summary>
<div markdown="1">

```Java
  @Nullable
  protected Object invokeWithinTransaction(Method method, @Nullable Class<?> targetClass, final InvocationCallback invocation) throws Throwable {
    TransactionAttributeSource tas = this.getTransactionAttributeSource();
    TransactionAttribute txAttr = tas != null ? tas.getTransactionAttribute(method, targetClass) : null;
    TransactionManager tm = this.determineTransactionManager(txAttr);
    if (this.reactiveAdapterRegistry != null && tm instanceof ReactiveTransactionManager rtm) {
      boolean isSuspendingFunction = KotlinDetector.isSuspendingFunction(method);
      boolean hasSuspendingFlowReturnType = isSuspendingFunction && "kotlinx.coroutines.flow.Flow".equals((new MethodParameter(method, -1)).getParameterType().getName());
      if (isSuspendingFunction && !(invocation instanceof CoroutinesInvocationCallback)) {
        throw new IllegalStateException("Coroutines invocation not supported: " + method);
      } else {
        CoroutinesInvocationCallback corInv = isSuspendingFunction ? (CoroutinesInvocationCallback)invocation : null;
        ReactiveTransactionSupport txSupport = (ReactiveTransactionSupport)this.transactionSupportCache.computeIfAbsent(method, (key) -> {
          Class<?> reactiveType = isSuspendingFunction ? (hasSuspendingFlowReturnType ? Flux.class : Mono.class) : method.getReturnType();
          ReactiveAdapter adapter = this.reactiveAdapterRegistry.getAdapter(reactiveType);
          if (adapter == null) {
            Class var10002 = method.getReturnType();
            throw new IllegalStateException("Cannot apply reactive transaction to non-reactive return type [" + var10002 + "] with specified transaction manager: " + tm);
          } else {
            return new ReactiveTransactionSupport(adapter);
          }
        });
        InvocationCallback callback = invocation;
        if (corInv != null) {
          callback = () -> {
            return TransactionAspectSupport.KotlinDelegate.invokeSuspendingFunction(method, corInv);
          };
        }

        return txSupport.invokeWithinTransaction(method, targetClass, callback, txAttr, rtm);
      }
    } else {
      PlatformTransactionManager ptm = this.asPlatformTransactionManager(tm);
      String joinpointIdentification = this.methodIdentification(method, targetClass, txAttr);
      if (txAttr != null && ptm instanceof CallbackPreferringPlatformTransactionManager cpptm) {
        ThrowableHolder throwableHolder = new ThrowableHolder();

        Object result;
        try {
          result = cpptm.execute(txAttr, (statusx) -> {
            TransactionInfo txInfo = this.prepareTransactionInfo(ptm, txAttr, joinpointIdentification, statusx);

            RuntimeException runtimeException;
            try {
              Object retVal = invocation.proceedWithInvocation();
              if (retVal != null && vavrPresent && TransactionAspectSupport.VavrDelegate.isVavrTry(retVal)) {
                retVal = TransactionAspectSupport.VavrDelegate.evaluateTryFailure(retVal, txAttr, statusx);
              }

              Object var15 = retVal;
              return var15;
            } catch (Throwable var13) {
              if (txAttr.rollbackOn(var13)) {
                if (var13 instanceof RuntimeException) {
                  runtimeException = (RuntimeException)var13;
                  throw runtimeException;
                }

                throw new ThrowableHolderException(var13);
              }

              throwableHolder.throwable = var13;
              runtimeException = null;
            } finally {
              this.cleanupTransactionInfo(txInfo);
            }

            return runtimeException;
          });
        } catch (ThrowableHolderException var24) {
          throw var24.getCause();
        } catch (TransactionSystemException var25) {
          if (throwableHolder.throwable != null) {
            this.logger.error("Application exception overridden by commit exception", throwableHolder.throwable);
            var25.initApplicationException(throwableHolder.throwable);
          }

          throw var25;
        } catch (Throwable var26) {
          if (throwableHolder.throwable != null) {
            this.logger.error("Application exception overridden by commit exception", throwableHolder.throwable);
          }

          throw var26;
        }

        if (throwableHolder.throwable != null) {
          throw throwableHolder.throwable;
        } else {
          return result;
        }
      } else {
        TransactionInfo txInfo = this.createTransactionIfNecessary(ptm, txAttr, joinpointIdentification);

        Object retVal;
        try {
          retVal = invocation.proceedWithInvocation();
        } catch (Throwable var22) {
          this.completeTransactionAfterThrowing(txInfo, var22);
          throw var22;
        } finally {
          this.cleanupTransactionInfo(txInfo);
        }

        if (retVal != null && txAttr != null) {
          TransactionStatus status = txInfo.getTransactionStatus();
          if (status != null) {
            label216: {
              if (retVal instanceof Future) {
                Future<?> future = (Future)retVal;
                if (future.isDone()) {
                  try {
                    future.get();
                  } catch (ExecutionException var27) {
                    if (txAttr.rollbackOn(var27.getCause())) {
                      status.setRollbackOnly();
                    }
                  } catch (InterruptedException var28) {
                    Thread.currentThread().interrupt();
                  }
                  break label216;
                }
              }

              if (vavrPresent && TransactionAspectSupport.VavrDelegate.isVavrTry(retVal)) {
                retVal = TransactionAspectSupport.VavrDelegate.evaluateTryFailure(retVal, txAttr, status);
              }
            }
          }
        }

        this.commitTransactionAfterReturning(txInfo);
        return retVal;
      }
    }
  }
```

</div>
</details>

- íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì € ë“±ì„ ì„¤ì •í•´ì¤€ë‹¤.

  ![image.png](./image/4.png)

  â‡’ JpaTransactionManagerê°€ ì£¼ì…ëœë‹¤.

  ![image.png](./image/5.png)


- íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê¸° ìœ„í•´ íŠ¸ëœì­ì…˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ë‹¤.

![image.png](./image/6.png)

- íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¥¼ í†µí•´ íŠ¸ëœì­ì…˜ì„ ê°€ì ¸ì˜¨ë‹¤.

<details>
<summary>createTransactionIfNecessary()</summary>
<div markdown="1">

```Java
  protected TransactionInfo createTransactionIfNecessary(@Nullable PlatformTransactionManager tm, @Nullable TransactionAttribute txAttr, final String joinpointIdentification) {
    if (txAttr != null && ((TransactionAttribute)txAttr).getName() == null) {
      txAttr = new DelegatingTransactionAttribute((TransactionAttribute)txAttr) {
        public String getName() {
          return joinpointIdentification;
        }
      };
    }

    TransactionStatus status = null;
    if (txAttr != null) {
      if (tm != null) {
        status = tm.getTransaction((TransactionDefinition)txAttr);
      } else if (this.logger.isDebugEnabled()) {
        this.logger.debug("Skipping transactional joinpoint [" + joinpointIdentification + "] because no transaction manager has been configured");
      }
    }

    return this.prepareTransactionInfo(tm, (TransactionAttribute)txAttr, joinpointIdentification, status);
  }
```

</div>
</details>

![image.png](./image/7.png)

## 3. `AbstractPlatformTransactionManager`

- êµ¬í˜„ì²´ì— êµ¬í˜„ëœ íŠ¸ëœì­ì…˜ ê°€ì ¸ì˜¤ê¸°

<details>
<summary>getTransaction()</summary>
<div markdown="1">

```Java
  public final TransactionStatus getTransaction(@Nullable TransactionDefinition definition) throws TransactionException {
    TransactionDefinition def = definition != null ? definition : TransactionDefinition.withDefaults();
    Object transaction = this.doGetTransaction();
    boolean debugEnabled = this.logger.isDebugEnabled();
    if (this.isExistingTransaction(transaction)) {
      return this.handleExistingTransaction(def, transaction, debugEnabled);
    } else if (def.getTimeout() < -1) {
      throw new InvalidTimeoutException("Invalid transaction timeout", def.getTimeout());
    } else if (def.getPropagationBehavior() == 2) {
      throw new IllegalTransactionStateException("No existing transaction found for transaction marked with propagation 'mandatory'");
    } else if (def.getPropagationBehavior() != 0 && def.getPropagationBehavior() != 3 && def.getPropagationBehavior() != 6) {
      if (def.getIsolationLevel() != -1 && this.logger.isWarnEnabled()) {
        this.logger.warn("Custom isolation level specified but no actual transaction initiated; isolation level will effectively be ignored: " + def);
      }

      boolean newSynchronization = this.getTransactionSynchronization() == 0;
      return this.prepareTransactionStatus(def, (Object)null, true, newSynchronization, debugEnabled, (Object)null);
    } else {
      SuspendedResourcesHolder suspendedResources = this.suspend((Object)null);
      if (debugEnabled) {
        Log var10000 = this.logger;
        String var10001 = def.getName();
        var10000.debug("Creating new transaction with name [" + var10001 + "]: " + def);
      }

      try {
        return this.startTransaction(def, transaction, false, debugEnabled, suspendedResources);
      } catch (Error | RuntimeException var7) {
        this.resume((Object)null, suspendedResources);
        throw var7;
      }
    }
  }

```

</div>
</details>

![image.png](./image/8.png)

## 4. `JpaTransactionManager`

- `AbstractPlatformTransactionManager` ì˜ êµ¬í˜„ì²´

- ë°ì´í„° ì†ŒìŠ¤ë¥¼ í†µí•´ ì»¤ë„¥ì…˜ ìƒì„±

<details>
<summary>doGetTransaction()</summary>
<div markdown="1">

```Java
  protected Object doGetTransaction() {
    JpaTransactionObject txObject = new JpaTransactionObject();
    txObject.setSavepointAllowed(this.isNestedTransactionAllowed());
    EntityManagerHolder emHolder = (EntityManagerHolder)TransactionSynchronizationManager.getResource(this.obtainEntityManagerFactory());
    if (emHolder != null) {
      if (this.logger.isDebugEnabled()) {
        this.logger.debug("Found thread-bound EntityManager [" + emHolder.getEntityManager() + "] for JPA transaction");
      }

      txObject.setEntityManagerHolder(emHolder, false);
    }

    if (this.getDataSource() != null) {
      ConnectionHolder conHolder = (ConnectionHolder)TransactionSynchronizationManager.getResource(this.getDataSource());
      txObject.setConnectionHolder(conHolder);
    }

    return txObject;
  }
```

</div>
</details>

![image.png](./image/9.png)

## 5. `AbstractPlatformTransactionManager`

- `getTransaction()`
- íŠ¸ëœì­ì…˜ ì†ì„± ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ íŠ¸ëœì­ì…˜ ì‹œì‘ ì¤€ë¹„

![image.png](./image/10.png)

- íŠ¸ëœì­ì…˜ ì‹œì‘

<details>
<summary>startTransaction()</summary>
<div markdown="1">

```Java
  private TransactionStatus startTransaction(TransactionDefinition definition, Object transaction, boolean nested, boolean debugEnabled, @Nullable SuspendedResourcesHolder suspendedResources) {
    boolean newSynchronization = this.getTransactionSynchronization() != 2;
    DefaultTransactionStatus status = this.newTransactionStatus(definition, transaction, true, newSynchronization, nested, debugEnabled, suspendedResources);
    this.transactionExecutionListeners.forEach((listener) -> {
      listener.beforeBegin(status);
    });

    try {
      this.doBegin(transaction, definition);
    } catch (Error | RuntimeException var9) {
      this.transactionExecutionListeners.forEach((listener) -> {
        listener.afterBegin(status, var9);
      });
      throw var9;
    }

    this.prepareSynchronization(status, definition);
    this.transactionExecutionListeners.forEach((listener) -> {
      listener.afterBegin(status, (Throwable)null);
    });
    return status;
  }
```

</div>
</details>

![image.png](./image/11.png)

## 6. `JpaTransactionManager`

- íŠ¸ëœì­ì…˜ ì‹œì‘ ì‹œ ì„¤ì • ì¶”ê°€

<details>
<summary>doBegin()</summary>
<div markdown="1">

```java
  protected void doBegin(Object transaction, TransactionDefinition definition) {
    JpaTransactionObject txObject = (JpaTransactionObject)transaction;
    if (txObject.hasConnectionHolder() && !txObject.getConnectionHolder().isSynchronizedWithTransaction()) {
      throw new IllegalTransactionStateException("Pre-bound JDBC Connection found! JpaTransactionManager does not support running within DataSourceTransactionManager if told to manage the DataSource itself. It is recommended to use a single JpaTransactionManager for all transactions on a single DataSource, no matter whether JPA or JDBC access.");
    } else {
      try {
        EntityManager em;
        if (!txObject.hasEntityManagerHolder() || txObject.getEntityManagerHolder().isSynchronizedWithTransaction()) {
          em = this.createEntityManagerForTransaction();
          if (this.logger.isDebugEnabled()) {
            this.logger.debug("Opened new EntityManager [" + em + "] for JPA transaction");
          }

          txObject.setEntityManagerHolder(new EntityManagerHolder(em), true);
        }

        em = txObject.getEntityManagerHolder().getEntityManager();
        int timeoutToUse = this.determineTimeout(definition);
        Object transactionData = this.getJpaDialect().beginTransaction(em, new JpaTransactionDefinition(definition, timeoutToUse, txObject.isNewEntityManagerHolder()));
        txObject.setTransactionData(transactionData);
        txObject.setReadOnly(definition.isReadOnly());
        if (timeoutToUse != -1) {
          txObject.getEntityManagerHolder().setTimeoutInSeconds(timeoutToUse);
        }

        if (this.getDataSource() != null) {
          ConnectionHandle conHandle = this.getJpaDialect().getJdbcConnection(em, definition.isReadOnly());
          if (conHandle != null) {
            ConnectionHolder conHolder = new ConnectionHolder(conHandle);
            if (timeoutToUse != -1) {
              conHolder.setTimeoutInSeconds(timeoutToUse);
            }

            if (this.logger.isDebugEnabled()) {
              this.logger.debug("Exposing JPA transaction as JDBC [" + conHandle + "]");
            }

            TransactionSynchronizationManager.bindResource(this.getDataSource(), conHolder);
            txObject.setConnectionHolder(conHolder);
          } else if (this.logger.isDebugEnabled()) {
            this.logger.debug("Not exposing JPA transaction [" + em + "] as JDBC transaction because JpaDialect [" + this.getJpaDialect() + "] does not support JDBC Connection retrieval");
          }
        }

        if (txObject.isNewEntityManagerHolder()) {
          TransactionSynchronizationManager.bindResource(this.obtainEntityManagerFactory(), txObject.getEntityManagerHolder());
        }

        txObject.getEntityManagerHolder().setSynchronizedWithTransaction(true);
      } catch (TransactionException var9) {
        this.closeEntityManagerAfterFailedBegin(txObject);
        throw var9;
      } catch (Throwable var10) {
        this.closeEntityManagerAfterFailedBegin(txObject);
        throw new CannotCreateTransactionException("Could not open JPA EntityManager for transaction", var10);
      }
    }
  }

```

</div>
</details>

![image.png](./image/12.png)

## ì¤‘ê°„ ìƒëµ

- í•˜ì´ë²„ë„¤ì´íŠ¸ ë“±ì—ì„œ ì„¤ì • í•´ì£¼ëŠ” ê³¼ì •

## 7. `AbstractLogicalConnectionImplementor`

- AutoCommitì„ falseë¡œ ì„¤ì •

<details>
<summary>begin()</summary>
<div markdown="1">


```java
  public void begin() {
    try {
      if (!this.doConnectionsFromProviderHaveAutoCommitDisabled()) {
        log.trace("Preparing to begin transaction via JDBC Connection.setAutoCommit(false)");
        this.getConnectionForTransactionManagement().setAutoCommit(false);
        log.trace("Transaction begun via JDBC Connection.setAutoCommit(false)");
      }

      this.status = TransactionStatus.ACTIVE;
    } catch (SQLException var2) {
      throw new TransactionException("JDBC begin transaction failed: ", var2);
    }
  }
```

</div>
</details>

![image.png](./image/13.png)

## 8. `JpaTransactionManager`

- íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ì— ì»¤ë„¥ì…˜ ì €ì¥
    - íŠ¸ëœì­ì…˜ì´ ì§„í–‰ë˜ëŠ” ë™ì•ˆ ë™ì¼í•œ ì»¤ë„¥ì…˜ì„ í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œì—ì„œ ì¼ê´€ë˜ê²Œ ì‚¬ìš©í•˜ë„ë¡ ë³´ë‹¹í•˜ê¸° ìœ„í•œ ê³¼ì •
    - `doBegin()` ì¼ë¶€

![image.png](./image/14.png)

## 9. `TransactionAspectSupport`

- ì‹¤ì œ íƒ€ê²Ÿ ë©”ì„œë“œ í˜¸ì¶œ

![image.png](./image/15.png)

# @Transactional ë‚´ë¶€ ì²˜ë¦¬ ê³¼ì •

![image.png](./image/16.png)

- @Transactional ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ ë©”ì„œë“œê°€ í˜¸ì¶œëœë‹¤.
- AOP í”„ë¡ì‹œê°€ í˜¸ì¶œëœë‹¤.
- íŠ¸ëœì­ì…˜ ì¸í„°ì…‰í„°ë¥¼ í†µí•´ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ë¡œì§ì´ ì‹¤í–‰ëœë‹¤.
- íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¥¼ ê²°ì •í•œë‹¤.
- íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¥¼ í†µí•´ ì»¤ë„¥ì…˜ì„ ìƒì„±í•œë‹¤.
- ì»¤ë„¥ì…˜ì„ ìƒì„±í•  ë•Œ AutoCommitì„ falseë¡œ ì„¤ì •í•˜ëŠ” ë“±ì˜ íŠ¸ëœì­ì…˜ ì„¤ì • ì‘ì—…ì„ ì§„í–‰í•œë‹¤.
- ìƒì„±ëœ ì»¤ë„¥ì…˜ì„ íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ë¥¼ í†µí•´ ë³´ê´€í•œë‹¤.
- @Transactional ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì–´ìˆë˜ ì‹¤ì œ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤.
- ë¦¬í¬ì§€í† ë¦¬ë¥¼ í†µí•´ ë°ì´í„° ë² ì´ìŠ¤ì— ì ‘ê·¼í•˜ëŠ” ë¡œì§ì„ ìš”ì²­í•œë‹¤.
- íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ë¥¼ í†µí•´ ì»¤ë„¥ì…˜ì„ íšë“í•˜ì—¬ ì›í•˜ëŠ” ë¡œì§ì„ ìˆ˜í–‰í•œë‹¤.

# @Transactional ì£¼ì˜ ì‚¬í•­

- AOP í”„ë¡ì‹œë¥¼ ê±°ì³ ì‹¤í–‰ë¨ì„ ëª…ì‹œí•˜ì.

### ê°™ì€ í´ë˜ìŠ¤ ë‚´ì—ì„œ ë©”ì„œë“œ ê°„ í˜¸ì¶œì€ í”„ë¡ì‹œë¥¼ ê±°ì¹˜ì§€ ì•Šê¸° ë•Œë¬¸ì— íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤!!!!

```java
@Service
public class exampleService {

  public void external() {
    log.info("call external");
    logTransactionStatus();
    internal();
  }

  @Transactional
  public void internal() {
    log.info("call internal");
    logTransactionStatus();
  }

  private void logTransactionStatus() {
    // íŠ¸ëœì­ì…˜ status ë¡œê·¸ ì¶œë ¥
  }
}
```

â‡’ `internal()`ì—ì„œ íŠ¸ëœì­ì…˜ ì ìš© XX

- í•´ê²° ë°©ë²•
    - í´ë˜ìŠ¤ ë¶„ë¦¬

### private ë©”ì„œë“œì— ì ìš©í•  ìˆ˜ ì—†ë‹¤!!!

- CGLIBë¥¼ í†µí•´ íƒ€ê²Ÿìœ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì€ í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•˜ê²Œ ë˜ëŠ”ë°
- privateì€ ìƒì†ë°›ì€ í•˜ìœ„ í´ë˜ìŠ¤ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ì—†ì–´ ì ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤.

# @Transactional í…ŒìŠ¤íŠ¸

- ë¡¤ë°± í…ŒìŠ¤íŠ¸
    - í…ŒìŠ¤íŠ¸ í›„ íŠ¸ëœì­ì…˜ì„ ìë™ìœ¼ë¡œ ë¡¤ë°±í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì˜ ìƒíƒœë¥¼ ìœ ì§€í•˜ê³ , í…ŒìŠ¤íŠ¸ ê°„ ë°ì´í„° ì¶©ëŒì„ ë°©ì§€í•˜ëŠ” ë°©ì‹
    - ë°ì´í„°ë² ì´ìŠ¤ì˜ ì´ˆê¸°í™” ì‘ì—…ì´ í•„ìš” ì—†ë‹¤.
    - ì§ì ‘ ì´ˆê¸°í™” í•˜ëŠ” ê²ƒ ë³´ë‹¤ ì„±ëŠ¥ì´ ë¹ ë¥´ë‹¤.
- ì£¼ì˜í•  ì 
    - í…ŒìŠ¤íŠ¸ ë©”ì„œë“œì— @Transactionalì„ ë¶™ì—¬ ì‚¬ìš©í•  ë•Œ, ì‹¤ì œ ì‚¬ìš© ë©”ì„œë“œì— @Transactionalì´ ë¶™ì–´ìˆì§€ ì•Šë”ë¼ë„ íŠ¸ëœì­ì…˜ì´ ì ìš©ë  ìˆ˜ ìˆë‹¤.
        - ì‹¤ì œ ì‚¬ìš© ì¼€ì´ìŠ¤ì—ì„œëŠ” ì •ìƒ ì‘ë™ë˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤!!

# íŠ¸ëœì­ì…˜ ì†ì„±

- Propagation
- Isolation
- read-only
- timeout
- rollback-for
- no-rollback-for

## Propagation ì „íŒŒ

- íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê±°ë‚˜ ê¸°ì¡´ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í•˜ëŠ” ë°©ë²•ì„ ê²°ì •í•˜ëŠ” ì†ì„±

### REQUIRED

- ê¸°ë³¸ ì†ì„±
- ìˆìœ¼ë©´ ì°¸ì—¬, ì—†ìœ¼ë©´ ìƒˆë¡œ ì‹œì‘

### REQUIRES_NEW

- í•­ìƒ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì„ ì‹œì‘
- ì§„í–‰ ì¤‘ì¸ íŠ¸ëœì­ì…˜ì´ ìˆë‹¤ë©´ ì ì‹œ ë³´ë¥˜ì‹œí‚´

![image.png](./image/17.png)

### SUPPORTS

- ì´ë¯¸ íŠ¸ëœì­ì…˜ì´ ìˆìœ¼ë©´ ì°¸ì—¬
- ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ íŠ¸ëœì­ì…˜ ì—†ì´ ì§„í–‰

### NESTED

- ì´ë¯¸ ì§„í–‰ ì¤‘ì¸ íŠ¸ëœì­ì…˜ì´ ìˆìœ¼ë©´ ì¤‘ì²© íŠ¸ëœì­ì…˜ ì‹œì‘
- ë¶€ëª¨ íŠ¸ëœì­ì…˜ ì»¤ë°‹, ë¡¤ë°±ì—” ì˜í–¥ì„ ë°›ìŒ
- ìì‹ ì˜ ì»¤ë°‹, ë¡¤ë°±ì€ ë¶€ëª¨ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ì—†ìŒ

### NEVER

- íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•Šê²Œ í•œë‹¤.
- ì¡´ì¬í•˜ë©´ ì˜ˆì™¸ ë°œìƒ

### NOT_SUPPORTED

- íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•Šê²Œ í•œë‹¤.
- ì¡´ì¬í•˜ë©´ ë³´ë¥˜

## Isolation ê²©ë¦¬

- ì—¬ëŸ¬ íŠ¸ëœì­ì…˜ì´ ì§„í–‰ë  ë•Œì— íŠ¸ëœì­ì…˜ì˜ ì‘ì—… ê²°ê³¼ë¥¼ íƒ€ íŠ¸ëœì­ì…˜ì—ê²Œ ì–´ë–»ê²Œ ë…¸ì¶œí•  ì§€ ê²°ì •

### DEFAULT

- ì‚¬ìš©í•˜ëŠ” ë°ì´í„° ì ‘ê·¼ ê¸°ìˆ , DB ë“œë¼ì´ë²„ì˜ ê¸°ë³¸ ì„¤ì •
    - Oracleì€ READ_COMMITED
    - Mysqlì€ REPEATABLE_READ

### READ_UNCOMMITED

- ì»¤ë°‹ë˜ì§€ ì•Šì€ ë°ì´í„°ë¥¼ ë…¸ì¶œì‹œí‚´
    - ë°ì´í„°ì˜ ì •í•©ì„±ì€ ë–¨ì–´ì§€ì§€ë§Œ
    - ì„±ëŠ¥ì´ ì¢‹ìŒ

### READ_COMMITED

- ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹í•˜ì§€ ì•Šì€ ì •ë³´ë¥¼ ì¡°íšŒí•  ìˆ˜ ì—†ìŒ
    - ì½ëŠ” ì‹œì ì— ë”°ë¼ì„œ ë°ì´í„°ê°€ ë³€ê²½ë  ìˆ˜ ìˆìŒ.

### REPEATABLE_READ

- ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ì½ì€ ì •ë³´ë¥¼ ìˆ˜ì •(ë³€ê²½)í•  ìˆ˜ ì—†ìŒ
    - íŠ¸ëœì­ì…˜ ë‚´ì—ì„œëŠ” ìŠ¤ëƒ…ìƒ· ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë…ë¦½ì ì´ë‹¤.

### SERIALIZABLE

- íŠ¸ëœì­ì…˜ì„ ìˆœì°¨ì ìœ¼ë¡œ ì§„í–‰ì‹œí‚´
    - ê·¹ë‹¨ì ìœ¼ë¡œ ì•ˆì „í•œ ì‘ì—…ì´ í•„ìš”í•  ë•Œ ì‚¬ìš©

## Timeout

- íŠ¸ëœì­ì…˜ì„ ìˆ˜í–‰í•˜ëŠ” ì œí•œ ì‹œê°„ì„ ì„¤ì •í•  ìˆ˜ ìˆìŒ
- ê¸°ë³¸ ì˜µì…˜ì—ëŠ” ì œí•œì‹œê°„ì´ ì—†ìŒ

## ReadOnly

- íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ë°ì´í„°ë¥¼ ì¡°ì‘í•˜ë ¤ëŠ” ì‹œë„ë¥¼ ë§‰ìŒ
- ë°ì´í„° ì ‘ê·¼ ê¸°ìˆ , ì‚¬ìš© DBì— ë”°ë¼ì„œ ì ìš© ì°¨ì´ê°€ ìˆìŒ
    - ì´ ì˜µì…˜ì„ ì¼œë”ë¼ë„ ë°ì´í„° ì¡°ì‘ ì‹œ ì˜ˆì™¸ê°€ ë°œìƒë˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆìŒ
- íŠ¸ëœì­ì…˜ id ê´€ë ¨ ì„¤ì •ì—ì„œ ì˜¤ë²„í—¤ë“œë¥¼ ì¤„ì—¬ ì½ê¸° í–‰ë™ ì‹œ ì°¸ì¡°í•˜ëŠ” ë°ì´í„° êµ¬ì¡°ë¥¼ ê°ì†Œì‹œí‚¤ë©´ì„œ ì„±ëŠ¥ì´ ì¦ê°€ë  ìˆ˜ ìˆë‹¤.

## Rollback-for

- ê¸°ë³¸ì ìœ¼ë¡œ RuntimeException ì‹œ ë¡¤ë°±
- ì²´í¬ ì˜ˆì™¸ì§€ë§Œ ë¡¤ë°± ëŒ€ìƒìœ¼ë¡œ ì‚¼ê³  ì‹¶ë‹¤ë©´ ì‚¬ìš©

## No-rollback-for

- ë¡¤ë°± ëŒ€ìƒì¸ RuntimeExceptionì„ ì»¤ë°‹ ëŒ€ìƒìœ¼ë¡œ ì§€ì •

# Reference

https://www.youtube.com/watch?v=cc4M-GS9DoY

https://www.youtube.com/watch?v=XJo5O6GrFC0

https://www.maeil-mail.kr/question/181